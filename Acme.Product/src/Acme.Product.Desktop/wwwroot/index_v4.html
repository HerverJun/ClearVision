<!doctype html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ClearVision - å·¥ä¸šè§†è§‰æ£€æµ‹è½¯ä»¶</title>
        <!-- ã€ç§‘å­¦æ–¹æ¡ˆäºŒã€‘åŠ¨æ€CSSç‰ˆæœ¬å·ï¼šé€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ï¼Œä½¿ç”¨åç«¯æ³¨å…¥çš„ç‰ˆæœ¬å· -->
        <script>
            // åŠ¨æ€åŠ è½½CSSï¼Œè‡ªåŠ¨é™„åŠ ç‰ˆæœ¬å·
            (function() {
                // ä¼˜å…ˆä½¿ç”¨åç«¯æ³¨å…¥çš„ç‰ˆæœ¬å·ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨æ—¶é—´æˆ³ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
                const version = window.__CSS_VERSION__ || (new Date()).getTime();
                const cssFiles = [
                    'src/shared/styles/variables.css',
                    'src/shared/styles/main.css',
                    'src/shared/styles/ui-components.css',
                    'src/shared/styles/settings.css',
                    'src/shared/styles/property-panel.css',
                    'src/shared/styles/settings-overrides.css',
                    'src/shared/styles/handdrawn.css' /* Hand-drawn Theme */
                ];
                
                cssFiles.forEach(function(file) {
                    const link = document.createElement('link');
                    link.rel = 'stylesheet';
                    link.href = file + '?v=' + version;
                    document.head.appendChild(link);
                });
                
                console.log('[CSS Loader] å·²åŠ è½½CSSæ–‡ä»¶ï¼Œç‰ˆæœ¬å·:', version);
            })();
        </script>
    </head>
    <body>
        <a href="#main-content" class="skip-link">è·³è½¬åˆ°ä¸»å†…å®¹</a>
        <div id="app">
            <!-- é¡¶éƒ¨å·¥å…·æ  -->
            <header class="toolbar">
                <div class="toolbar-left">
                    <h1 class="logo">ClearVision</h1>
                    <nav class="main-nav" aria-label="ä¸»å¯¼èˆª">
                        <button class="nav-btn" data-view="project">
                            å·¥ç¨‹
                        </button>
                        <button class="nav-btn active" data-view="flow">
                            æµç¨‹
                        </button>
                        <button class="nav-btn" data-view="inspection">
                            æ£€æµ‹
                        </button>
                        <button class="nav-btn" data-view="results">
                            ç»“æœ
                        </button>
                    </nav>
                </div>
                <div class="toolbar-right">
                    <button id="btn-save" class="btn btn-primary">ä¿å­˜</button>
                    <button id="btn-run" class="btn btn-success">è¿è¡Œ</button>
                    <button id="btn-theme-toggle" class="btn btn-icon" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ“</button>
                    <button id="btn-settings" class="btn btn-icon">âš™ï¸</button>
                </div>
            </header>

            <!-- ä¸»å†…å®¹åŒº -->
            <main class="main-content" id="main-content">
                <!-- å·¦ä¾§é¢æ¿ -->
                <aside class="sidebar left">
                    <div class="panel">
                        <h3 class="panel-title">ç®—å­åº“</h3>
                        <div class="operator-library" id="operator-library">
                            <!-- ç®—å­åˆ—è¡¨å°†åŠ¨æ€åŠ è½½ -->
                        </div>
                    </div>
                </aside>

                <!-- ä¸­é—´å·¥ä½œåŒº -->
                <section class="workspace">
                    <!-- æµç¨‹ç¼–è¾‘å™¨ -->
                    <div class="flow-editor-container" id="flow-editor">
                        <canvas id="flow-canvas"></canvas>
                    </div>

                    <!-- å›¾åƒæŸ¥çœ‹å™¨ï¼ˆé»˜è®¤éšè—ï¼‰ -->
                    <div
                        class="image-viewer-container hidden"
                        id="image-viewer"
                    ></div>

                    <!-- å·¥ç¨‹è§†å›¾ï¼ˆé»˜è®¤éšè—ï¼‰ -->
                    <div
                        class="project-view-container hidden"
                        id="project-view"
                    >
                        <div class="project-view-header">
                            <div class="project-search">
                                <input
                                    type="text"
                                    id="project-search-input"
                                    placeholder="æœç´¢å·¥ç¨‹..."
                                    class="cv-input"
                                />
                                <button id="btn-search-project" class="btn">
                                    æœç´¢
                                </button>
                                <button id="btn-new-project-inline" class="btn btn-primary">
                                    + æ–°å»ºå·¥ç¨‹
                                </button>
                            </div>
                            <div class="project-tabs">
                                <button class="tab-btn active" data-tab="all">
                                    å…¨éƒ¨å·¥ç¨‹
                                </button>
                                <button class="tab-btn" data-tab="recent">
                                    æœ€è¿‘æ‰“å¼€
                                </button>
                            </div>
                        </div>
                        <div class="project-list" id="project-list">
                            <!-- åŠ¨æ€åŠ è½½å·¥ç¨‹å¡ç‰‡ -->
                            <p class="empty-text">åŠ è½½ä¸­...</p>
                        </div>
                    </div>

                    <!-- ç»“æœè§†å›¾ï¼ˆé»˜è®¤éšè—ï¼‰ -->
                    <div
                        class="results-view-container hidden"
                        id="results-view"
                    >
                        <div class="results-view-header">
                            <h2>æ£€æµ‹ç»“æœå†å²</h2>
                            <div class="results-actions">
                                <button
                                    class="btn btn-secondary"
                                    id="btn-clear-results"
                                >
                                    æ¸…ç©ºè®°å½•
                                </button>
                                <button
                                    class="btn btn-primary"
                                    id="btn-export-results"
                                >
                                    å¯¼å‡ºCSV
                                </button>
                            </div>
                        </div>
                        <div
                            class="results-view-content"
                            id="results-view-content"
                        >
                            <p class="empty-text">æš‚æ— æ£€æµ‹è®°å½•</p>
                        </div>
                    </div>
                </section>

                <!-- å³ä¾§é¢æ¿ -->
                <aside class="sidebar right">
                    <div class="panel">
                        <h3 class="panel-title">å±æ€§</h3>
                        <div class="property-panel" id="property-panel">
                            <p class="empty-text">é€‰æ‹©ä¸€ä¸ªç®—å­æŸ¥çœ‹å±æ€§</p>
                        </div>
                    </div>

                    <div class="panel">
                        <h3 class="panel-title">ç»“æœ</h3>
                        <div class="results-panel" id="results-panel">
                            <div class="result-summary">
                                <span class="result-ok">OK: 0</span>
                                <span class="result-ng">NG: 0</span>
                            </div>
                        </div>
                    </div>
                </aside>
            </main>

            <!-- åº•éƒ¨çŠ¶æ€æ  -->
            <footer class="status-bar">
                <div class="status-left">
                    <span id="status-text">å°±ç»ª</span>
                </div>
                <div class="status-right">
                    <span id="project-name">æœªå‘½åå·¥ç¨‹</span>
                    <span id="version">v1.0.0</span>
                </div>
            </footer>
        </div>

        <!-- åŠ è½½æ ¸å¿ƒæ¨¡å— -->
        <script
            type="module"
            src="src/core/messaging/webMessageBridge.js"
        ></script>
        <script type="module" src="src/core/messaging/httpClient.js"></script>
        <script type="module" src="src/core/state/store.js"></script>
        <script type="module" src="src/core/canvas/flowCanvas.js"></script>
        <script type="module" src="src/core/canvas/imageCanvas.js"></script>

        <!-- åŠ è½½åŠŸèƒ½æ¨¡å— -->
        <script
            type="module"
            src="src/features/operator-library/operatorLibrary.js"
        ></script>
        <script
            type="module"
            src="src/features/image-viewer/imageViewer.js"
        ></script>
        <script
            type="module"
            src="src/features/inspection/inspectionController.js"
        ></script>
        <script
            type="module"
            src="src/features/results/resultPanel.js"
        ></script>

        <!-- åŠ è½½ä¸»åº”ç”¨ -->
        <script type="module" src="src/app.js"></script>
    </body>
</html>

